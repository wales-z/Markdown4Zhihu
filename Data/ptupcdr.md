# Personalized Transfer of User Preferences for Cross-domain Recommendation

## 摘要

冷启动问题在推荐系统中仍然是一个非常具有挑战性的问题。 幸运的是，辅助源域中冷启动用户的交互可以帮助目标域中的冷启动推荐。 如何将用户的偏好从源域转移到目标域，是跨域推荐（CDR）中的关键问题，它是处理冷启动问题的有前途的解决方案。大多数现有方法建模一个通用的偏好桥 (preference bridge) 来为所有用户传递偏好。直观上，由于用户的偏好不同，不同用户的偏好桥应该是不同的。沿着这条路线，我们提出了一个名为跨域推荐用户偏好个性化转移（PTUPCDR）的新框架。具体来说，学习一个以用户特征嵌入为馈送的元网络，以生成个性化的桥接函数，以实现每个用户的个性化偏好转移。 为了稳定地学习元网络，我们采用了面向任务的优化程序。通过元生成的个性化桥接功能，可以将源域中的用户偏好嵌入转化为目标域，并将转换后的用户偏好嵌入作为冷启动用户在目标域中的初始嵌入。使用大型真实世界数据集，我们进行了大量实验来评估 PTUPCDR 在冷启动和热启动阶段的有效性。该代码已在 https://github.com/easezyc/WSDM2022-PTUPCDR 上提供。

## 1 引言

推荐系统在 Web 和移动应用程序中扮演着越来越重要的角色。 近年来，推荐系统引起了工业界和学术界的广泛兴趣，研究人员进行了大量研究以提高推荐性能[1, 10]。 然而，这些推荐系统中的大多数都很难为没有历史交互的新用户（即冷启动用户）提供令人满意的推荐。

跨域推荐 (CDR) [24] 旨在将知识从信息源域转移到目标域，是缓解冷启动问题的有前途的解决方案。  CDR 的核心任务是在源域和目标域中桥接用户的偏好，也称为偏好转移 [30]。 为了实现偏好转移，许多现有的 CDR 方法 [4, 8, 16, 32] 假设所有用户在源域和目标域中共享用户偏好之间的相同关系，并学习所有用户共享的公共偏好桥，如图 1 (a) 所示。

在实践中，由于个体差异，源域和目标域的用户偏好之间的复杂关系因用户而异。 因此，单个网桥很难捕捉到如此复杂多样的关系，这可能会降低这些 CDR 方法的性能。 为了减轻这个缺点，有必要使用个性化的桥梁来模拟不同领域用户偏好之间的各种关系。 换句话说，偏好转移的过程应该是个性化的。

沿着这条路线，我们提出了一个名为跨域推荐用户偏好个性化转移（PTUPCDR）的新框架。  PTUPCDR 学习一个元网络，该网络将用户在源域中的特征嵌入作为输入，并为每个用户生成个性化的桥梁，如图 1 (b) 所示。 生成的桥接函数可以看作是由学习到的元网络参数化的模型。需要注意的是，依赖于用户特征的个性化桥接功能因用户而异，因此偏好转移的过程是个性化的，比现有方法可以更好地捕捉不同领域之间的偏好关系。训练后，我们将源域中的用户嵌入提供给元生成的个性化桥接函数，并获得转换后的用户嵌入。转换后的用户嵌入用作目标域中的初始嵌入。通过初始嵌入，我们的方法对于在目标域中没有交互的冷启动用户是有效的。



![image-20211030203623058](https://gitee.com/Wales-Z/image_bed/raw/master/img/image-20211030203623058.png)

在实践中，高级元网络很难优化 [18, 23]，如何优化元网络是另一个挑战。为了学习桥接函数，现有的基于桥接的方法 [4, 8, 16, 32] 采用面向映射的优化程序来直接最小化转换后的用户嵌入与信息源域之间的距离与用户嵌入到目标域。 换句话说，通过这样的优化过程，桥接函数对用户嵌入的质量很敏感。在实际的推荐系统中，很难为所有用户学习合理的嵌入 [20, 35]，这限制了通过面向映射优化学习的桥接函数的性能。此外，我们发现很难通过面向映射的优化来学习元网络。因此，为了训练元网络，我们采用面向任务的优化过程，跳过用户在目标域中的嵌入，直接利用评分任务作为优化目标。

文献中的大多数现有作品 [4, 8, 16, 30, 32] 仅通过在极端冷启动阶段将其方法应用于简单的基础模型（矩阵分解）来证明其有效性（用户在目标域中没有交互）。 由于此类设置与现实世界场景相距甚远，我们进一步探索如何在更实际的场景中使用 PTUPCDR 来验证 PTUPCDR 在现实世界推荐中的兼容性和实用性，例如，热启动场景、更复杂的基础模型。实验结果表明，我们提出的 PTUPCDR 在实际推荐中具有良好的兼容性和实用性。

我们工作的主要贡献总结为三方面：

- 为了解决 CDR 中的冷启动问题，我们提出了一种名为 PTUPCDR 的新方法，利用元网络为每个用户生成个性化的桥接功能，给定源域中编码用户的特征。
- 为了稳定地学习元网络，我们采用面向任务的优化程序来减轻不合理用户嵌入的副作用。
- 我们使用 Amazon 评论数据集对三个跨域任务进行了广泛的实验，以证明 PTUPCDR 不仅适用于冷启动场景而且适用于热启动场景的有效性和稳健性，而许多现有方法仅证明它们在冷启动场景下的有效性 。



## 3 模型

### 3.1 问题设定

在跨域推荐中，我们有一个源域和一个目标域。每个域都有一个用户集 $ U = \{𝑢_1, 𝑢_2, ...\}$，一个物品集 $ V = \{𝑣_1, 𝑣_2, ...\}$，以及一个评分矩阵 $R$。$ 𝑟_{𝑖𝑗}\in R$ 表示用户 $𝑢_i$ 和物品 $v_j$ 之间的交互。为了区分这两个域，我们将源域的用户集、物品集和评分矩阵表示为 $U^𝑠,V^𝑠,R^𝑠$ ，而 $U^𝑡,V^𝑡, R^𝑡$ 表示目标域的。 我们将两个域之间的重叠用户定义为 $U^𝑜 = U^𝑠 ∩ U^𝑡$ 。 相比之下，$V^𝑠$ 和 $V^𝑡$ 是不相交的，这意味着两个域之间没有共享项。
在潜在因子模型中，用户和物品被转换为密集向量，也称为因子或嵌入。在本文中，$𝒖^𝑑_𝑖 \in \mathbb R^𝑘$ 和 $ 𝒗^𝑑_𝑗 \in \mathbb R^𝑘$ 分别表示用户 $u^d_i$ 和物品 $v^d_j$ 的嵌入，$d \in \{s,t\}$ 表示域标识。对于每个用户 $𝑢_𝑖$ ，我们用 $S_{𝑢_𝑖} = \{𝑣^𝑠_{𝑡_1} ,𝑣^𝑠_{𝑡_2} ,·  · · , 𝑣^𝑠 _{𝑡_n}\}$ 表示其在源域中按顺序交互过的物品，其中 $n$ 表示物品数量，$v^s_{t_n}$ 表示在时间戳 $t_n$ 交互的源域物品。

### 3.2 个性化编码器 (characteristic encoder)

生成个性化桥接函数的第一步是从交互物品中捕捉用户的个性化的可迁移特征。但是，冷启动用户在目标域中没有交互项。 因此，必须利用源域中的交互项 $S$。 请注意，我们需要找到有助于知识迁移的可迁移特征。

直观上，各种物品对知识迁移有不同的贡献。注意力机制 [28, 31] 允许不同部分在将它们压缩为单一表示时做出不同的贡献。因此，我们建议通过执行加权求和对物品嵌入使用注意力机制
$$
\boldsymbol p_{u_i}= \sum_{v^s_j \in S_{u_i}} a_j \boldsymbol v^s_j
\tag1
$$
其中 $ 𝒑_{𝑢_𝑖} \in \mathbb R^𝑘$ 表示用户 $𝑢_𝑖$ 的可迁移个性化嵌入， $𝑎_𝑗$ 是项目 $𝑣_𝑗$ 的注意力分数，可以解释为 $𝑣_𝑗$ 在预测个性化桥接函数中的重要性。 对于目标域，一个不相关物品对所有用户的个性化桥接功能几乎没有帮助。因此，我们通过注意力网络从项目的嵌入中学习注意力分数。 形式上，注意力网络定义为
$$
a'_j=h(\boldsymbol v_j;\theta)\\
a_j = \frac{\exp (a'_j)}{\sum_{v^s_l \in S_{u,i}}\exp(a'_l)}
\tag 2
$$
其中 $ℎ(·)$ 表示注意力网络，而$\theta$表示 $ℎ(·)$ 的参数。在本文中，$ℎ(·)$ 是一个两层前馈网络。请注意，归一化注意力分数 $𝑎_𝑗$ 有利于为特定用户找到有用的交互项目。之后，我们可以利用每个用户的特征作为输入来指导个性化桥接功能的生成。

### 3.3 元网络 (meta-network)

我们已经提到，不同领域的偏好之间的用户关系因用户而异。换句话说，偏好转移的过程需要个性化。 直观上，偏好关系与用户特征之间存在一定的联系。基于这种直觉，我们提出了一个元网络，它将用户的可迁移特征作为输入，然后在用户在源域和目标域中的嵌入之间生成个性化的桥接函数。元网络被公式化为：
$$
\boldsymbol w_{u_i} = g(\boldsymbol p_{u_i};\phi)
\tag3
$$
其中 $𝑔(·)$ 是元网络，由 $𝜙$ 参数化。在本文中，元网络是一个两层前馈网络。$𝒘_{𝑢_𝑖}$ 是一个向量，其长度取决于桥函数的结构。个性化桥接函数公式为：
$$
f_{u_i}(\cdot;\boldsymbol w_{u_i})
\tag4
$$
它利用 $𝒘_{𝑢_𝑖}$作为桥函数 $𝑓(·)$ 的参数。桥函数可以定义为任何结构。在本文中，为简单起见，我们按照 EMCDR [8, 16] 使用线性层作为 $𝑓 (·)$。
因此，为了适应桥梁参数的大小，我们将向量 $𝒘_{𝑢_𝑖} \in \mathbb R^{k^2}$ 重塑为矩阵 $𝒘_{𝑢_𝑖} \in \mathbb R ^{𝑘 \times 𝑘}$ 。请注意，$𝒘_{𝑢_𝑖}$ 用作桥函数的参数而不是输入。生成的桥接函数取决于用户的特征，因用户而异，我们称之为个性化桥接函数。使用个性化桥接功能，我们可以获得个性化转换后的用户嵌入：
$$
\hat{\boldsymbol u} ^s_i = f_{u_i} (\boldsymbol u^s_i;\boldsymbol w_{u_i})
\tag5
$$
其中 $𝒖^𝑠_𝑖$ 表示用户 $𝑢_𝑖$ 在源域中的嵌入，而 $\hat 𝒖^𝑡_i$ 表示转换后的嵌入。最后，我们可以利用转换后的嵌入 $\hat 𝒖^𝑡_𝑖$ 来做预测。

### 3.4 面向任务的优化

为了训练元网络和特征编码器，我们可以按照现有的基于桥接的方法 [4, 8, 16, 32] 使用面向映射的优化程序来最小化距离：
$$
{\cal L} = \sum_{u_i \in U^o} ||\hat {\boldsymbol u}^t_i - \boldsymbol u^t_i||^2
\tag6
$$
其中 $\hat 𝒖^𝑡_i$ 表示从 $ \hat 𝒖^𝑠_𝑖$ 在源域中转换后的用户嵌入，而 $𝒖^𝑡_i$ 表示在目标域中的用户嵌入。
面向映射的优化过程将使转换后的嵌入 $\hat 𝒖^𝑡_𝑖$ 接近目标嵌入$𝒖^𝑡 _𝑖$ 。

然而，由于一些用户只有有限的交互，用户的嵌入 $𝒖^𝑡_𝑖$ 可能不够合理和准确。学习相对不合理的嵌入会导致对模型的负面影响。因此，我们提出了一种面向任务的优化来训练元网络和特征编码器。面向任务的训练过程直接利用最终推荐任务的性能作为优化目标。 在本文中，我们专注于评分任务，因此面向任务的损失可以表示为：
$$
\min_{\theta, \phi} \frac{1}{R^t_o} \sum_{r_{ij}\in R^t_o}
(r_{ij}-f_{u_i}(\boldsymbol u^s_i;w_{u_i}) \boldsymbol v_j)^2
\tag7
$$
其中 $R^t_𝑜 = \{𝑟_{𝑖𝑗} | 𝑢_𝑖 \in U^𝑜，𝑣_𝑗 \in V^𝑡\}$ 表示目标域中重叠用户的交互。

与面向映射的过程相比，面向任务的优化有两个优点：

(1) 面向任务的优化可以减轻不合理嵌入的影响。 它直接使用评分数据，这是真实情况而不是近似的中间结果。

(2) 面向任务的学习过程有更多的训练样本，可以避免过拟合。例如，对于 𝑁 个重叠用户，每个用户都有 $𝑀$ 个评分。 面向映射的过程通过 $|U^o = 𝑁 |$ 个样本学习映射函数，如等式（6），而面向任务的学习过程利用 $|R^𝑡_𝑜|= 𝑀 \times 𝑁 $ 个用户-项目评分，如等式（7）。

### 3.5 总体流程

PTUPCDR 的整体结构如图 2 所示。 训练过程可以分为三个步骤：预训练、元和初始化阶段，见算法 1。训练后，该方法可用于冷启动和热启动。

![image-20211030223501340](https://gitee.com/Wales-Z/image_bed/raw/master/img/image-20211030223501340.png)

【图 2】

![image-20211030224045564](https://gitee.com/Wales-Z/image_bed/raw/master/img/image-20211030224045564.png)

【算法1】

#### 3.5.1 预训练阶段

这一步是分别学习每个域的潜在空间。损失函数被表述为：
$$
\min_{\boldsymbol u, \boldsymbol v} \frac{1}{|R|}
\sum_{r_{ij}\in R} (r_{ij} - \boldsymbol u_i \boldsymbol v_j)^2
\tag8
$$
其中$|R|$ 表示评分的数量。在预训练步骤之后，我们可以获得预训练的嵌入 $𝒖^𝑠,𝒖^𝑡,𝒗^𝑠,𝒗^𝑡$ 。

#### 3.5.2 元阶段

现有方法直接训练一个普通的桥接函数，而 PTUPCDR 训练特征编码器和元网络。特征编码器和元网络使用等式（7）进行优化。

#### 3.5.3 初始化阶段

当新用户到来时（CDR 假设新用户在源域中有一些交互），我们使用转换后的嵌入 $\hat {\boldsymbol u}^t_i =f_{u_i}({\boldsymbol u}^s_i;\boldsymbol w_{u_i})$ 来初始化新用户在目标域的嵌入。

#### 3.5.4 测试阶段

对于目标域中没有交互的极端冷启动用户，直接利用初始嵌入$\hat 𝒖^𝑡_𝑖 = 𝑓_{𝑢_𝑖} (𝒖^𝑠_𝑖 ;𝒘_{𝑢_𝑖})$  进行预测。 对于在目标域中有一些交互的热启动用户，可以方便地用新的交互微调初始嵌入，并利用微调的嵌入进行预测。

