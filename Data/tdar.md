# 【推荐系统论文笔记】TDAR: Semi-supervised Collaborative Filtering by Text-enhanced Domain Adaptation

TDAR：**T**ext-enhanced **D**omain **A**daptation **R**ecommendation

## 摘要

------

数据稀疏性是推荐系统的固有挑战，其中大部分数据是从用户的隐式反馈中收集的。这给设计有效算法带来了两个困难：

- 第一，大多数用户与系统的交互很少，没有足够的数据可供学习；
- 其次，隐式反馈中没有负样本，执行负采样生成负样本是一种常见的做法。然而，这会导致许多潜在的正样本被错误标记为负样本，而且数据稀疏会加剧错误标记（mislabeling）问题。

为了解决这些困难，我们将稀疏隐式反馈的推荐问题视为半监督学习任务，并探索域自适应（domain adaptation）来解决它。我们将从密集数据中学到的知识转移到稀疏数据中，而且我们重点关注最具挑战性的情况——没有用户或物品重叠。

在这种极端情况下，直接对齐（align）两个数据集的embeddings是次优的（sub-optimal），因为两个潜在空间（latent space）的编码信息差别很大。因此，我们采用域不变（domain-invariant）的文本特征作为锚点来对齐潜在空间。为了对齐embeddings，我们提取每个用户和物品的文本特征，并将它们输入到具有用户和物品的embeddings的域分类器中。这些embeddings被训练用于迷惑（puzzle）分类器，文本特征被固定为锚点。通过域自适应，源域中的分布模式被迁移到目标域。由于目标域的部分可以通过域适应来监督，我们放弃了目标域数据集中的负采样以避免标签噪声。

我们采用三对真实世界的数据集来验证我们的迁移策略的有效性。结果表明，我们的模型明显优于现有模型。

------

## 关键词

迁移学习、域自适应、协同过滤、物品推荐、用户评论、对抗性学习。

## 1 介绍  INTRODUCTION

由于在电子商务和视频网站等各种在线平台上的普遍应用，推荐系统获得了广泛的研究关注。在实际应用中，隐式反馈数据（一类数据，如点击和购买等）被广泛使用，因为它易于收集且普遍适用（generally applicable）。实际应用中的推荐通常存在严重的稀疏性问题，这会导致两个困难：

(1) 没有足够的交互来为模型学习提供信息。此外，数据高度不平衡：大多数用户和物品与系统只有很少的交互，这使得推荐任务更加困难。 
(2) 由于我们在隐式反馈中只观察到一小部分正样本，现有的负采样策略是将未观察到的样本视为负样本 [6, 18, 21, 25, 27]。
然而，通过这种方式，许多潜在的正样本被错误地标记为负样本，并且模型被标签噪声严重误导，尤其是在稀疏数据上。

为了解决上述挑战，我们采用迁移学习来丰富稀疏数据集上的信息，并且我们专注于没有用户和物品重叠的跨域推荐。具体来说，我们分别在稠密和稀疏数据上训练源模型和目标模型，并探索域自适应 [4, 5] 以对齐embeddings（即潜在因子 latent factors），这是协同过滤 (CF) 模型中对用户偏好进行编码的关键组成部分。我们将从密集数据中学到的知识（如分布模式）迁移到稀疏数据中，以学习它更好的embeddings。考虑到目标模型同时受到正样本和域适应机制的监督，我们不对稀疏数据进行负采样以避免标签噪声问题。正如我们所见，学习目标模型是一项半监督学习任务。

为了说明我们的策略，我们首先简要介绍域自适应。Ganin等人[5] 提出了用于无监督图像分类任务的域对抗性神经网络 (DANN)。在 DANN 中，训练一个特征提取器来提取视觉特征，同时训练一个域分类器来辨别当前特征来自哪个域（分类）。通过对抗地训练特征提取器来迷惑域分类器，两个域的视觉特征被对齐，而且从源域中学到的知识被迁移到了目标域。域自适应的更多细节可以在第 2.1.1 小节中找到。

在本文中，我们的目标是在推荐任务中通过域适应来对齐embeddings，但面临一个关键问题。我们在图 1 中说明了 vanilla DANN 和我们的策略。 DANN 被提出并被用于图像分类任务，它在视觉空间中对齐高级的（high-level）图像表示。由于两个域共用相同的特征提取器，来自两个域的图像被映射到相同的空间，因此语义相似的图像分布在此空间中的相似位置。通过域自适应，具有相似语义的集群（clusters）被对齐在一起，且分布模式被迁移以改善（refine）目标域上的表示。以图 1 (a) 中展示的视觉空间为例，负半轴和正半轴分别编码猫和狗，因此来自不同域的猫都映射到负半轴并通过域自适应对齐在一起。

<img src="tdar/figure1.png" alt="figure1" style="zoom:80%;" />

<center>图1 计算机视觉任务和推荐任务中的域适应示例。我们使用不同的颜色来区分两个域，使用实线和虚线来区分不同的类别。为了简洁，视觉空间、潜在空间和文本空间都表示为一维空间。</center>

然而，在基本的 CF 模型中，没有具有特定语义的数据（例如图像和文本），我们通过将用户和物品嵌入（embedding）到潜在空间中来提取高级的密集特征。通过这种方式，我们将来自不同领域的用户和物品映射到不同的潜在空间。以图1 (b)中的电影为例，实线和虚线分别表示恐怖片和喜剧片。如图1 (b) 所示，直接对齐embeddings可能会引起误导——来自“橙色”域的恐怖电影和来自“蓝色”域的喜剧被聚集在一起，并且分布模式被错误地迁移移。原因是这些embeddings被映射到不同的潜在空间——在“橙色”域上，负半轴和正半轴分别编码恐怖和有趣，而在“蓝色”域上，我们面临相反的情况。为了解决这个间隔 / 差距（gap），我们需要在同一个空间中进行域适应，即我们既对齐空间又对齐embeddings。

为了对齐潜在空间，我们探索域不变特征作为锚点。在本文中，我们利用了可以从用户评论（review）中轻松提取的文本特征。一个例子如图 1 (c) 所示，我们将文本特征与embedding连接（concatenate）起来，从而将空间扩展为文本潜在空间（横轴表示潜在空间，纵轴表示文本空间）。在图 1(b) 所示的潜在空间中，不同的类别是不可分离的，而在图 1(c) 中，不同的类别可以通过扩展文本维度来分离。对于域自适应，我们使用连接的embeddings和文本特征作为域分类器的输入。embeddings使用分类器进行对抗训练，而文本特征则固定。

正如我们所见，在我们的策略中，文本特征应该是域不变的，例如，来自所有域的恐怖电影都映射到文本空间的负半轴。现有的许多模型 [2, 30] 提取文本特征用于推荐，而这些特征不是域不变的。
为了缩小这一差距，首先，我们提出了一种称为文本记忆网络 ( Text Memory Network，TMN) 的记忆结构，通过将每个用户和物品映射到单词语义空间（word semantic space）来提取文本特征。
​然后，我们将这些特征注入 CF 模型以生成预测。这个由文本特征和CF模块组成的模型被命名为文本协同过滤（Text Collaborative Filtering，TCF）模型。最后，我们在源域和目标域上同步训练两个 TCF 模型，并通过自适应网络将它们连接起来。这个迁移学习模型被命名为文本增强域自适应推荐 (Text-enhanced Domain Adaptation Recommendation，TDAR) 方法。

具体来说，我们的贡献如下：

- 我们通过将embeddings对齐到相同的潜在空间来提出一种域自适应推荐方法（TDAR），这大大提高了稀疏数据集的性能。为了对齐空间和embeddings，我们使用文本特征作为锚点。
- 作为 TDAR 中的一个重要模块，我们设计了一个记忆网络来提取域不变的文本特征，并将这些特征注入到 CF 模型中以提出基于文本的 CF 模型。
- 我们在三对真实世界数据集上设计了综合实验，以证明我们提出的方法的有效性。代码可在 https://github.com/Wenhui-Yu/TDAR 上获得。



## 2 相关工作

最近，推荐系统（RS）因其在各种在线平台上的广泛应用而受到越来越多的关注。我们根据历史交互对用户偏好进行建模，并将个性化推荐返回给每个用户。在各种 RS 模型中，CF 模型以直接 [7, 22] 和高级 [13, 20] 方式从用户-物品交互图中挖掘协同信息（collaborative infromation）。隐语义模型 / 潜在因素模型（latent factor models） [8, 13, 20] 被认为是一种特殊的 CF 模型，使用embeddings对用户偏好和物品属性进行编码，并测量embeddings在潜在空间中的距离。为了提高表示能力，已经提出了许多变体 [6, 24, 26, 28, 30]。虽然进行了广泛的研究，但是仍然存在一个关键问题：RS 存在严重的稀疏问题，并且在稀疏数据上的性能还有很多不足之处。在本文中，我们的目标是利用迁移学习来丰富稀疏数据的信息，并使用文本特征作为锚点，因此我们在本节中介绍了最相关的方面：跨域推荐和基于文本的推荐。

### 2.1 跨域推荐

在本小节中，我们首先介绍核心技术——域自适应，然后介绍一些关于有重叠和无重叠的跨领域推荐的相关工作。

#### 2.1.1 域自适应

为了学习只有残缺的标签甚至没有标签的数据，迁移学习被提出，将从标记良好的源数据集学到的知识迁移到目标数据集 [1, 4, 5, 15] 。Ganin等人[5]提出了用于无监督图像分类任务的 DANN。假设$\{{\bf x}_i^d, y_i^d\}_{i=1,...,m;d=S}$是带标记的源数据，$\{{\bf x}_i^d\}_{i=1,...,n;d=T}$是无标记的目标数据。DANN有三部分：一个特征提取器$G_f(,\theta_f)$（CNN的卷积层），一个标签预测器$G_y(,\theta_y)$（CNN的全连接层）和一个域分类器$G_d(,\theta_d)$。模型训练的时候，分别在在源域更新 $\theta_f$ 和  $\theta_y$ 来最小化标签预测损失$\sum_iL(G_y(G_f({\bf x}_i^S,\theta_f),\theta_y),y_i^S)$和训练 $\theta_d$ 和 $\theta_f$ 来最小化域预测损失$\sum_{i,d}L(G_d(G_f({\bf x}_i^d,\theta_f),\theta_d),d)$。通过对抗地训练 $\theta_d$ 和 $\theta_f$ ，两个域的视觉特征 $G_f({\bf x}_i^S, \theta_f)$ 和 $G_f({\bf x}_i^T, \theta_f) $ 被对齐了，而且从源域学到的知识也被迁移到了目标域。



#### 2.1.2 有重叠的跨域推荐

有许多模型被提出用于有用户和物品重叠的跨域推荐。

- 潘等人[19] 通过直接最小化源embeddings和目标embeddings之间的距离的 Frobenius 范数来减小二者的差异。
- 卢等人[16] 提出了一种选择性迁移学习方法，该方法基于 boost 算法决定要迁移的内容。
- 胡等人[9] 在源域和目标域上提出了两个深度神经网络，通过共享用户embeddings层，将所有用户和物品映射到同一个潜在空间，通过构建两个网络之间的交叉连接（cross connections），实现参数跨域迁移。
- 袁等人[29] 通过自动编码器对每个用户进行编码，并通过域自适应对齐用户表示。
- 胡等人[10]使用在源域上与当前用户有交互的物品来增强目标域上的当前物品的表示，并使用用户评论来提高模型性能。



我们可以看到迁移学习很容易实现，因为存在用户和物品重叠。在这种情况下，两个域的用户-物品二分图是整个图的不同部分，我们可以通过简单地在两个域之间共享重叠用户和物品的embeddings来迁移知识。然而，如果没有重叠，两个图是完全独立的，embeddings是不可共享的，因此我们必须使用更高级的方法，例如域自适应。



#### 2.1.3 无重叠的跨域推荐

无重叠的跨域推荐有多种模型。

- Kanagawa等人[11] 介绍了一个有趣的任务——基于文本将源域中的物品推荐给目标域中的用户。为了实现这个目标，用自动编码器提取文本特征并通过域自将它们对齐。 
- Wang 等人 [23] 提出了长短期记忆（LSTM）来构建用户和物品的文本表示，并将两个域的它们对齐用于迁移学习。

正如我们所看到的，这些模型 [11, 23] 在文本空间中实现了域自适应，因为embeddings很难在没有重叠的情况下对齐。在这种情况下，[11, 23] 中的跨域推荐更接近于自然语言处理 (NLP) 任务而不是推荐任务。 

- Li 等人[14] 提出了一种“码本（codebook）”方法，该方法在集群级别（cluster-level）迁移评分模式，但过于粗糙和经验主义。此外，该方法基于用户的评分模式，因此难以扩展到隐式反馈的情形。

在本文中，我们的目标是改进embeddings，这是 CF 模型的关键表示。据我们所知，本文是第一篇专注于无用户和物品重叠的跨域推荐任务的embeddings对齐的工作。



### 2.2 基于文本的推荐

由于我们想使用文本特征作为锚点来对齐embeddings，我们为每个用户和物品提取域不变的文本特征。在本小节中，我们将介绍一些基于文本的推荐模型。 [11, 23]中介绍的基本模型都是基于文本的模型。

- Kanagawa等人[11] 设计了一个自动编码器，而且利用 LSTM 来提取用户和物品的文本表示。
- 郑等人[30] 为每个用户和物品聚集评论，并通过卷积神经网络 (CNN) 从这些评论中提取文本特征。
- Chen [2] 等人进一步增加了注意力机制。 

然而，这些现有模型提取的文本特征不是域不变的。受 [10] 的启发，我们在本文中提出了一种用于文本特征的记忆网络。



## 3 文本记忆网络

在本文中，粗体大写字母表示矩阵。假设总共有 $M$ 个用户和 $N$ 个物品，我们使用矩阵 ${\bf R} ∈ \mathbb R ^{M×N}$ 来表示用户和物品之间的交互。 如果用户 $u$ 投票给物品 $i$，则 ${\bf R}_{ui} = 1$，否则 ${\bf R}_{ui} = 0$。我们的任务是对缺失值（${\bf R}$ 中的 $0$）进行预测（表示为 $\hat {\bf R}$）。

在本节中，我们根据评论构建特定用户和特定物品（user- and item- specific）的文本表示。请注意，本节设计的模型是针对信号域的，我们分别提取源域和目标域的文本特征。以用户 $u$ 为例，我们构造了一个评论集 $R_u = \bigcup ^N _{i=1} r_{ui}$ ，其中 $r_{ui}$ 是一个包含 $u$ 对 $i$ 的评论的词的集合。如果 $u $与 $i$ 没有交互，则 $r_{ui} = \emptyset$。类似地，物品 $i$ 的评论集是 $R_i = \bigcup ^M _{u=1} r_{ui}$ 。我们用 $W$ 来表示词集：$W = \bigcup ^M _{u=1} \bigcup ^N _{i=1} r_{ui}$ ，用 $H$ 来表示词的总数：$H = |W|$。由于我们想要提取域不变的文本特征（即来自所有域的特征都在同一空间中），我们通过线性组合评论的词语义(word semantic)向量将所有用户和物品映射到词语义空间。${\bf S}\in \mathbb R ^{H\times K_1}$ 是word2vec[17]在GoogleNews语料库上预训练的词语义矩阵1，${\bf S}_w$表示词$w$的语义特征。我们使用 ${\bf E} ∈ \mathbb R ^{M×K_1}$ 和 ${\bf F} ∈ \mathbb R ^{N×K_1}$ 分别表示我们为用户和物品构建的文本特征。以用户 $u$ 为例，${\bf E}_u = \sum_{w\in R_u} a_{uw} {\bf S}_w$ ，其中 $a_{uw}$ 是词 $w$ 基于 $u$ 的语义偏好的权重。我们提出了一个文本记忆网络 (TMN) 来计算用户 { $a_{uw}$ } 和物品 { $a_{iv}$ } 的权重，以根据单词语义构建文本特征。

对喜欢恐怖电影的用户，你可能更喜欢相关的词（比如“horrible”、“frightened”、“terrifying”），对不相关的词（比如“this”、“is”、“a  ”）和相反的词（如“funny”、“relaxing”、“comical”）没兴趣。 对于 $u$ 偏爱的词 $w$，我们需要为 $w$ 设置一个很大的权重 $a_{uw}$。在物品方面，对于恐怖片 $i$，$i$ 的评论中的相关词提供了很多关于 $i$ 的信息，而不相关或相反的词提供的信息很少。针对对 $i$ 很重要的词 $v$，我们需要设置一个很大的权重 $a_{iv}$ 。容易看出，在这个任务中，我们的目标是向用户和物品推荐偏好词 (preferred words)。

